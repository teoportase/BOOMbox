@page "/WioBoard"
@using Utils

<head>
    @* <link rel="stylesheet" href="/css/site.css"/> *@
    @* You can add the css files here *@
    <!-- Imports jquery library -->
    <!-- Imports ajaxTest file under the wwwroot/js folder -->
    <link rel="stylesheet" href="css/site.css" />
</head>

@code{
    [Inject] IJSRuntime JsRuntime { get; set; }
    public float CameraSpeed { get; set; } = 4f;

    private async Task UpdateCameraSpeed()
    {
        Console.WriteLine("WioBoard.razor:" + CameraSpeed);
        await JsRuntime.InvokeVoidAsync("babylonInterop.updateCameraSpeed", CameraSpeed);
    }

    private string mqttReply;

    private async Task SubscribeToMqtt()
    {
        var mqttConnection = MqttConnection.GetInstance();
        await mqttConnection.Subscribe("sound");

        while (true)
        {
            mqttReply = mqttConnection.Reply;
            StateHasChanged();
            await Task.Delay(100);
            Console.WriteLine("Testing this");
        }
    }

    //This function will run on page load
    protected override async Task OnInitializedAsync()
    {
        //Subsribing to a MQTT topic
        await SubscribeToMqtt();
    }
}

<div class="center">
    <h1 class="h1-test">WioBoard</h1>
    <p><a href="/">Go to Main Page</a></p>
    <p>Camera Speed: @CameraSpeed</p>
    <p>MQTT Reply: @mqttReply</p>
</div>

<div>
    <label for="camera-speed-slider">Camera Speed:</label>
    <input type="range" id="camera-speed-slider" min="-10" max="10" step="0.05" @bind="CameraSpeed" @oninput="UpdateCameraSpeed"/>
</div>

<BabylonCanvas />

@*@code{
    

    private async Task UpdateCameraWithMqtt()
    {
        Console.WriteLine("WioBoard.razor:" + MqttConnection.GetInstance().Reply);
        await JsRuntime.InvokeVoidAsync("babylonInterop.updateCameraSpeed", MqttConnection.GetInstance().Reply);
    }
}*@